default: default/

environment:
  variables:
    FPM_BINARY: php-fpm

configs:
  fpm_conf:
    file: config/fpm.conf
    parameters:
      global_options:
        error_log: /dev/stderr
      pool_options:
        pm: static
        pm.max_children: 2
        catch_workers_output: yes
  php_ini:
    file: config/php.ini
    parameters: {}

sandboxes:
  common:
    actions:
      start:
        command:
          executable: {{ .Env.FPM_BINARY }}
          args: -c {{ .Config.php_ini }} -F -y {{ Config.fpm_conf }}
      stop:
        signal: SIGTERM
      reload:
        signal: SIGUSR2

expectations:
  variables:
    executable: {{ .Env.FPM_BINARY }}
  items:
    server-start:
      output:
        order: fixed
        messages:
          - '{{ .Log.date }} NOTICE: {{ .Log.executable }} is running, pid {{ .Log.pid }}"'
          - "{{ .Log.date }} NOTICE: ready to handle connections"